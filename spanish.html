<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spanish Chatterbox</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4361ee;
            --primary-light: #5a7cff;
            --secondary: #3f37c9;
            --accent: #4895ef;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4cc9f0;
            --warning: #f72585;
            --info: #7209b7;
            --text: #2b2d42;
            --text-light: #4a4d6b;
            --bg: #f8f9fa;
            --card-bg: #ffffff;
            --dark-bg: #1a1a2e;
            --dark-card: #16213e;
            --dark-text: #e6e6e6;
            --dark-text-light: #b8b8b8;
            --border-radius: 12px;
            --box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            --transition: all 0.3s ease;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            width: 100vw;
            padding: 20px;
            font-size: 16px;
            transition: var(--transition);
            line-height: 1.6;
        }
        
        body.dark-mode {
            background-color: var(--dark-bg);
            color: var(--dark-text);
        }
        
.container {
    width: 95%;
    max-width: 1200px;
    text-align: center;
    background-color: var(--card-bg);
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    padding: 60px 40px;
    position: relative;
    overflow: hidden;
    transition: var(--transition);
    font-size: 1.2rem;
}
        
        body.dark-mode .container {
            background-color: var(--dark-card);
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        
        .header {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 30px;
            text-align: center;
            letter-spacing: -0.5px;
        }
        
        body.dark-mode .header {
            color: var(--accent);
        }
        
        .controls-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
            gap: 20px;
        }
        
        .dropdown {
            flex: 1;
            min-width: 0;
            position: relative;
        }
        
        select {
            width: 100%;
            padding: 15px 20px;
            font-size: 1rem;
            border-radius: var(--border-radius);
            border: 2px solid var(--primary);
            background-color: var(--card-bg);
            color: var(--text);
            cursor: pointer;
            appearance: none;
            transition: var(--transition);
        }
        
        select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }
        
        body.dark-mode select {
            background-color: var(--dark-card);
            color: var(--dark-text);
            border-color: var(--accent);
        }
        
        .dropdown:after {
            content: "▼";
            font-size: 0.8rem;
            color: var(--primary);
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
        }
        
        body.dark-mode .dropdown:after {
            color: var(--accent);
        }
        
        .file-upload-row {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            gap: 20px;
        }
        
        .file-input-container {
            flex: 1;
            position: relative;
            min-width: 0;
        }
        
        .file-input-label {
            display: block;
            width: 100%;
            padding: 15px 20px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: var(--border-radius);
            background-color: var(--primary);
            color: white;
            cursor: pointer;
            text-align: center;
            transition: var(--transition);
            border: 2px solid transparent;
        }
        
        .file-input-label:hover {
            background-color: var(--primary-light);
            transform: translateY(-2px);
        }
        
        .file-input-label:active {
            transform: translateY(0);
        }
        
        body.dark-mode .file-input-label {
            background-color: var(--accent);
        }
        
        body.dark-mode .file-input-label:hover {
            background-color: var(--primary-light);
        }
        
        #fileNameDisplay {
            font-size: 0.9rem;
            margin-top: 10px;
            color: var(--text-light);
            text-align: center;
        }
        
        body.dark-mode #fileNameDisplay {
            color: var(--dark-text-light);
        }
        
        .btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 15px 20px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            flex: 1;
            min-width: 0;
            border: 2px solid transparent;
        }
        
        .btn:hover {
            background-color: var(--primary-light);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.2);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background-color: var(--text-light);
        }
        
        body.dark-mode .btn:disabled {
            background-color: var(--dark-text-light);
        }
        
        body.dark-mode .btn {
            background-color: var(--accent);
        }
        
        body.dark-mode .btn:hover {
            background-color: var(--primary-light);
        }
        
.night-mode-toggle {
    position: fixed;
    top: 20px;
    right: 20px;
    background-color: var(--dark);
    color: white;
    border: none;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    font-size: 1.2rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    transition: var(--transition);
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}
        
        .night-mode-toggle:hover {
            transform: scale(1.1);
        }
        
        body.dark-mode .night-mode-toggle {
            background-color: var(--light);
            color: var(--dark);
        }

        /* READING MODE STYLES */
        .reading-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            background-color: var(--card-bg);
            color: var(--text);
            z-index: 100;
            overflow: hidden;
            padding: 15px;
            box-sizing: border-box;
            transition: var(--transition);
        }
        
        body.dark-mode .reading-container {
            background-color: var(--dark-card);
            color: var(--dark-text);
        }
        
        /* Ensure all elements in reading mode respect dark mode */
        body.dark-mode .reading-header,
        body.dark-mode .reading-footer {
            background-color: var(--dark-card);
            color: var(--dark-text);
        }
        
        body.dark-mode .sentence-display {
            color: var(--dark-text);
        }
        
        body.dark-mode .fruit-toggle {
            background-color: var(--success);
        }
        
        body.dark-mode .exit-reading {
            background-color: var(--warning);
        }
.reading-header {
    display: flex;
    justify-content: space-between;
    padding: 15px;
    align-items: center;
    position: relative;
}
.page-counter {
    position: absolute;
    left: 20px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 0.9rem;
    color: var(--text-light);
    font-weight: 600;
}

body.dark-mode .page-counter {
    color: var(--dark-text-light);
}

.exit-reading {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    top: 15px;
    background-color: var(--warning);
    color: white;
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    font-size: 1.2rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    z-index: 10;
}
        
.fruit-toggle {
    background-color: var(--warning);
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 20px;
    font-size: 0.9rem;
    cursor: pointer;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    flex-shrink: 0; /* Prevent button from growing */
    margin: 0 5px; /* Add some horizontal spacing */
}

.fruit-toggle.on {
    background-color: var(--success);
}
        
        .reel-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .fruit-name {
            font-size: 1.2rem;
            height: 30px;
            text-align: center;
            color: var(--primary);
            font-weight: bold;
            min-width: 100px;
        }
        
.reading-content {
    display: flex;
    flex-direction: column;
    width: 100%;
    height: calc(100% - 120px); /* Reduced to account for smaller footer */
    padding: 0 20px;
    overflow: hidden;
    margin-bottom: 60px; /* Space for fixed footer */
}
        
        .sentence-row {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            padding: 10px 20px; /* More side padding */
            width: 100%;
            overflow: hidden;
            min-height: 0;
            box-sizing: border-box;
            max-height: 50vh; /* Prevent overlap with header/footer */
        }
        
        .sentence-row:first-child {
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }
        
        body.dark-mode .sentence-row:first-child {
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
.sentence-controls {
    display: flex;
    align-items: center;
    gap: 10px;
    width: 100%;
    position: relative;
}

.play-btn {
    background-color: var(--primary);
    color: white;
    border: none;
    width: 40px;
    height: 40px;
    min-width: 40px;
    border-radius: 50%;
    font-size: 1rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    margin-right: 10px;
}

/* Update the sentence display to take remaining space */
.sentence-display {
    font-size: 5vw;
    line-height: 1.4;
    text-align: left;
    word-break: break-word;
    overflow: hidden;
    width: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: 5px;
    box-sizing: border-box;
    white-space: normal;
    min-height: 0;
    flex: 1;
    max-height: 100%;
    text-overflow: ellipsis;
}
        
.reading-footer {
    display: flex;
    justify-content: space-between;
    padding: 10px;
    align-items: center;
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 10;
    background-color: var(--card-bg);
    box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
    transition: background-color 0.3s;
    height: 60px; /* Reduced height */
    gap: 10px; /* Add space between items */
}
        
        body.dark-mode .reading-footer {
            background-color: var(--dark-card);
            box-shadow: 0 -5px 15px rgba(0,0,0,0.3);
        }
        
.nav-btn {
    flex-shrink: 0; /* Prevent buttons from growing */
    background-color: var(--primary);
    color: white;
    border: none;
    width: 50px; /* Reduced size */
    height: 50px; /* Reduced size */
    border-radius: 50%;
    font-size: 1.2rem; /* Smaller font */
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    transition: all 0.2s;
    position: relative;
    z-index: 20;
    margin: 0 10px; /* Added some spacing */
}

        .nav-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
        }

        .nav-btn:active {
            transform: scale(0.98);
        }
        
        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Translation Popup Styles */
        .translation-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 800px;
            background-color: var(--card-bg);
            color: var(--text);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 1000;
            padding: 30px;
            display: none;
            max-height: 90vh;
            overflow-y: auto;
            transition: background-color 0.3s, color 0.3s;
        }

        body.dark-mode .translation-popup {
            background-color: var(--dark-card);
            color: var(--dark-text);
        }
.language-label {
    font-size: 1.2rem;
    margin-bottom: 5px;
    color: var(--primary);
    font-weight: bold;
}

body.dark-mode .language-label {
    color: var(--accent);
}

        .translation-original {
            font-size: 2.5rem !important;
            margin-bottom: 20px !important;
            padding: 20px !important;
            background-color: rgba(0,0,0,0.05) !important;
            border-radius: 12px !important;
        }

        .translation-result {
            font-size: 2.5rem !important;
            padding: 20px !important;
            background-color: rgba(67, 97, 238, 0.1) !important;
            border-radius: 12px !important;
        }

        .translation-tts {
            font-size: 2rem !important;
            padding: 15px 25px !important;
            margin-top: 25px !important;
        }

        .translation-popup-header h3 {
            font-size: 2.5rem !important;
        }

        .translation-popup-close {
            width: 50px !important;
            height: 50px !important;
            font-size: 2rem !important;
        }

        .translation-popup.active {
            display: block;
        }

        .translation-popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        .translation-popup-close {
            background-color: var(--warning);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .translation-content {
            margin-bottom: 15px;
        }

        .translation-original {
            font-size: 1.5rem;
            margin-bottom: 10px;
            padding: 10px;
            background-color: rgba(0,0,0,0.05);
            border-radius: 8px;
        }

        .translation-result {
            font-size: 1.5rem;
            padding: 10px;
            background-color: rgba(67, 97, 238, 0.1);
            border-radius: 8px;
        }

        .translation-tts {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 15px;
        }

        .translation-tts:hover {
            background-color: var(--secondary);
        }

        .translation-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }

        .translation-overlay.active {
            display: block;
        }
@media (max-width: 768px) {
    .translation-popup {
        width: 95%;
        padding: 15px;
        max-height: 80vh;
    }
    
    .translation-original, .translation-result {
        font-size: 1.2rem !important;
        padding: 10px !important;
    }
    
    .translation-popup-header h3 {
        font-size: 1.5rem !important;
    }
    
    .translation-tts {
        font-size: 1rem !important;
        padding: 10px 15px !important;
    }
}
        
        /* Fruit Game Styles */
        .fruit-game-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 200;
        }
        
.fruit-game {
    background-color: var(--card-bg);
    color: var(--text);
    padding: 30px;
    border-radius: 20px;
    text-align: center;
    max-width: 800px;
    width: 90%;
    transition: var(--transition);
}

body.dark-mode .fruit-game {
    background-color: var(--dark-card);
    color: var(--dark-text);
    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
}
        
        .fruit-reels {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }
        
.fruit-reel {
    font-size: 8rem;  /* Increased from 4rem */
    width: 150px;     /* Increased from 100px */
    height: 150px;    /* Increased from 100px */
    display: flex;
    justify-content: center;
    align-items: center;
    background-color: var(--card-bg);
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    transition: var(--transition);
}

body.dark-mode .fruit-reel {
    background-color: var(--dark-card);
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
}

        
        /* Confetti animation */
        @keyframes confetti-fall {
            0% {
                transform: translateY(-10px) rotate(0deg);
                opacity: 0.8;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* Shake animation */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        @media (max-width: 800px) {
            .sentence-display {
                font-size: 32px !important; /* Minimum readable size */
            }
            
            .controls-row, .file-upload-row {
                flex-direction: column;
            }
            
            select, .btn, .file-input-label {
                font-size: 1.2rem;
                padding: 12px;
            }
            
            .header {
                font-size: 2rem;
                margin-bottom: 20px;
            }
            
    .fruit-reels {
        flex-wrap: wrap;  /* Allow reels to wrap on small screens */
        gap: 10px;
    }
    
    .fruit-reel {
        font-size: 4rem;  /* Slightly smaller */
        width: 90px;      /* Reduced from 120px */
        height: 90px;     /* Reduced from 120px */
    }
    
    .reel-container {
        margin-bottom: 15px;
    }
        }
        @media (max-width: 768px) {
    .sentence-row {
        flex-direction: row;
        align-items: center;
        padding: 5px;
    }
    
    .play-btn {
        width: 32px;
        height: 32px;
        font-size: 0.8rem;
        margin-right: 8px;
    }
    
@media (max-width: 768px) {
    .sentence-display {
        font-size: 1.5rem !important;  /* Increased from 1rem */
        padding: 5px;
        line-height: 1.4;
        min-height: 60px;  /* Ensure enough space for tapping */
    }
    
    .sentence-row {
        min-height: 80px;  /* More space for each sentence */
    }
}
            .container {
                padding: 30px 20px;
                width: 100%;
            }
            
            .controls-row, .file-upload-row {
                flex-direction: column;
                gap: 15px;
            }
            
            .header {
                font-size: 1.8rem;
                margin-bottom: 25px;
            }
            
            select, .btn, .file-input-label {
                padding: 12px 15px;
                font-size: 0.9rem;
            }
            
            .night-mode-toggle {
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }
        }
@media (min-width: 1280px) {
    .nav-btn {
        width: 60px;
        height: 60px;
        font-size: 1.5rem;
    }
    
    .reading-footer {
        height: 70px;
    }
    
    .reading-content {
        height: calc(100% - 130px);
        margin-bottom: 70px;
    }
}
/* Main container - only affects home screen */
#mainContainer.container {
    width: 95%;
    max-width: 1200px; /* Increased from 800px */
    padding: 60px 40px; /* Increased padding */
    font-size: 1.2rem; /* Base font size increase */
}

/* Only target header in main container */
#mainContainer .header {
    font-size: 4rem; /* Increased from 2.2rem */
    margin-bottom: 50px; /* Increased from 30px */
}

/* Only target dropdowns in main container */
#mainContainer .controls-row {
    display: flex;
    flex-direction: column; /* Stack vertically */
    margin-bottom: 25px;
    gap: 30px; /* Increased gap */
}

#mainContainer select {
    padding: 25px 30px; /* Increased from 15px 20px */
    font-size: 1.8rem; /* Increased from 1rem */
    border-width: 3px; /* Thicker border */
}

#mainContainer .dropdown:after {
    font-size: 1.5rem; /* Increased from 0.8rem */
    right: 30px; /* Adjusted position */
}

/* Larger screens adjustment */
@media (min-width: 1024px) {
    #mainContainer .header {
        font-size: 5rem;
        margin-bottom: 60px;
    }
    
    #mainContainer select {
        padding: 30px 35px;
        font-size: 2rem;
    }
    
    #mainContainer .dropdown:after {
        font-size: 2rem;
        right: 35px;
    }
}
    </style>
</head>
<body>
    <button class="night-mode-toggle" id="nightModeToggle">🌙</button>
    <div class="container" id="mainContainer">

        <div class="header">SPANISH CHATTERBOX</div>
        
        <div class="controls-row">
            <div class="dropdown">
<select id="contentSelector">
    <option value="">Select Content</option>
    <option value="questions">Questions</option>
    <option value="stories">Stories</option>
</select>
            </div>
            
            <div class="dropdown">
                <select id="storySelector" disabled>
                    <option value="">Select Story</option>
                </select>
            </div>
        </div>
        
    </div>

    <!-- READING MODE CONTAINER -->
    <div class="reading-container" id="readingModeContainer" style="display: none;">
<div class="reading-header">
    <div class="page-counter">Page <span id="currentPage">1</span> of <span id="totalPages">1</span></div>
    <button id="exitReading" class="exit-reading">X</button>
</div>
        
        <div class="reading-content">
<div class="sentence-row">
    <div class="sentence-controls">
        <button id="playSpanish" class="play-btn">▶</button>
        <div id="spanishSentence" class="sentence-display"></div>
    </div>
</div>

<div class="sentence-row">
    <div class="sentence-controls">
        <button id="playEnglish" class="play-btn">▶</button>
        <div id="englishSentence" class="sentence-display"></div>
    </div>
</div>
        
<div class="reading-footer">
    <button id="prevSentence" class="nav-btn">←</button>
    <button id="fruitToggle" class="fruit-toggle">🎰 Fruit Game OFF</button>
    <button id="nextSentence" class="nav-btn">→</button>
</div>
    </div>

    <!-- Translation Popup -->
    <div class="translation-overlay" id="translationOverlay"></div>
<div class="translation-popup" id="translationPopup">
    <div class="translation-popup-header">
        <h3>TRANSLATION</h3>
        <button class="translation-popup-close" id="closeTranslationPopup">×</button>
    </div>
    <div class="translation-content">
        <div class="language-label" id="sourceLanguageLabel">Spanish:</div>
        <div class="translation-original" id="translationOriginal"></div>
        
        <div class="language-label" id="targetLanguageLabel">English:</div>
        <div class="translation-result" id="translationResult"></div>
        
        <button class="translation-tts" id="translationTts">
            <span>🔊 PLAY SOUND</span>
        </button>
    </div>
</div>
    
    <script>
        // Spanish content from your files
        const spanishContent = {
            questions: `#QUESTIONS  
🐶¿Cómo te llamás?  
What’s your name?  
😊¿Cómo estás hoy?  
How are you today?  
🎂¿Cuántos años tienes?  
How old are you?  
🏠¿Dónde vives?  
Where do you live?  
👨‍👩‍👧‍👦¿Cuántas personas hay en tu familia?  
How many people are in your family?  
🐱¿Tienes una mascota?  
Do you have a pet?  
🌈¿Cuál es tu color favorito?  
What’s your favorite color?  
🍎¿Te gustan las manzanas?  
Do you like apples?  
🍕¿Cuál es tu comida favorita?  
What’s your favorite food?  
🎮¿Te gustan los videojuegos?  
Do you like video games?  
⚽¿Practicas deportes?  
Do you play sports?  
📺¿Cuál es tu programa de TV favorito?  
What’s your favorite TV show?  
🎵¿Te gusta la música?  
Do you like music?  
📚¿Te gusta leer libros?  
Do you like reading books?  
✏️¿Cuál es tu materia favorita en la escuela?  
What’s your favorite subject in school?  
🛏️¿A qué hora te duermes?  
What time do you go to sleep?  
☀️¿Prefieres el sol o la lluvia?  
Do you prefer sun or rain?  
🍦¿Te gusta el helado?  
Do you like ice cream?  
🎨¿Te gusta dibujar?  
Do you like to draw?  
🚲¿Sabes andar en bicicleta?  
Can you ride a bike?  
🐻¿Cuál es tu animal favorito?  
What’s your favorite animal?  
🎭¿Te gusta disfrazarte?  
Do you like dressing up?  
🏖️¿Prefieres la playa o la montaña?  
Do you prefer the beach or the mountains?  
🍌¿Te gustan los plátanos?  
Do you like bananas?  
📱¿Tienes un teléfono?  
Do you have a phone?  
🎈¿Qué haces en tu cumpleaños?  
What do you do on your birthday?  
🦷¿Se te ha caído algún diente?  
Have you lost a tooth?  
🧩¿Te gustan los rompecabezas?  
Do you like puzzles?  
🚗¿Te gustan los coches?  
Do you like cars?  
👑¿Quién es tu superhéroe favorito?  
Who’s your favorite superhero?  
🎤¿Te gusta cantar?  
Do you like singing?  
🧸¿Tienes un peluche favorito?  
Do you have a favorite stuffed animal?  
🍿¿Te gusta el cine?  
Do you like going to the movies?  
🧁¿Prefieres pastel o galletas?  
Do you prefer cake or cookies?  
🚀¿Quieres viajar al espacio?  
Do you want to travel to space?  
🏰¿Te gustan los cuentos de hadas?  
Do you like fairy tales?  
🎸¿Tocas algún instrumento?  
Do you play an instrument?  
🌮¿Te gustan los tacos?  
Do you like tacos?  
🎯¿Eres bueno en los juegos?  
Are you good at games?  
👟¿Te gusta correr?  
Do you like running?  
🍓¿Cuál es tu fruta favorita?  
What’s your favorite fruit?  
🎲¿Te gustan los juegos de mesa?  
Do you like board games?  
🦸‍♂️¿Qué quieres ser de grande?  
What do you want to be when you grow up?  
🍪¿Te gusta hornear galletas?  
Do you like baking cookies?  
🌍¿Hablas otro idioma?  
Do you speak another language?  
🎪¿Te gusta el circo?  
Do you like the circus?  
🛒¿Te gusta ir de compras?  
Do you like shopping?  
🎭¿Te gusta actuar?  
Do you like acting?  
🦜¿Puedes imitar animales?  
Can you imitate animals?  
🎨¿Cuál es tu arte favorito?  
What’s your favorite art?  
🚂¿Te gustan los trenes?  
Do you like trains?  
🍯¿Te gusta la miel?  
Do you like honey?  
🎡¿Te gusta la feria?  
Do you like the fair?  
🧦¿Tienes calcetines divertidos?  
Do you have fun socks?  
🎷¿Te gusta el jazz?  
Do you like jazz?  
🍉¿Prefieres sandía o melón?  
Do you prefer watermelon or cantaloupe?  
🏆¿Has ganado un premio?  
Have you won a prize?  
🦕¿Te gustan los dinosaurios?  
Do you like dinosaurs?  
🎣¿Te gusta pescar?  
Do you like fishing?  
🍩¿Te gustan las donas?  
Do you like donuts?  
🎠¿Te gustan los carruseles?  
Do you like carousels?  
🧀¿Te gusta el queso?  
Do you like cheese?  
🎳¿Juegas boliche?  
Do you play bowling?  
🎙️¿Te gusta hablar en público?  
Do you like public speaking?  
🥑¿Te gusta el aguacate?  
Do you like avocado?  
🎆¿Te gustan los fuegos artificiales?  
Do you like fireworks?  
🧊¿Prefieres calor o frío?  
Do you prefer hot or cold?  
🎄¿Te gusta la Navidad?  
Do you like Christmas?  
🦸‍♀️¿Tienes un poder imaginario?  
Do you have an imaginary superpower?  
🍍¿Te gusta la piña?  
Do you like pineapple?  
🎹¿Sabes tocar el piano?  
Can you play the piano?  
🏝️¿Te gustaría vivir en una isla?  
Would you like to live on an island?  
🍫¿Prefieres chocolate blanco o negro?  
Do you prefer white or dark chocolate?  
🎭¿Te gusta el teatro?  
Do you like theater?  
🦄¿Crees en unicornios?  
Do you believe in unicorns?  
🎢¿Te gustan las montañas rusas?  
Do you like roller coasters?  
🥞¿Te gustan los panqueques?  
Do you like pancakes?  
🎰¿Has jugado en un casino (de juguete)?  
Have you played (toy) casino games?  
🪁¿Te gusta volar cometas?  
Do you like flying kites?  
🎇¿Te gustan las luces brillantes?  
Do you like bright lights?  
🍒¿Te gustan las cerezas?  
Do you like cherries?  
🎳¿Eres bueno en boliche?  
Are you good at bowling?  
🛌¿Duermes con un peluche?  
Do you sleep with a stuffed animal?  
🎸¿Te gusta la guitarra?  
Do you like the guitar?  
🍄¿Te gustan los hongos?  
Do you like mushrooms?  
🎲¿Te gustan los dados?  
Do you like dice games?  
🦀¿Te gustan los cangrejos?  
Do you like crabs?  
🎧¿Escuchas música con audífonos?  
Do you listen to music with headphones?  
🍇¿Prefieres uvas verdes o moradas?  
Do you prefer green or purple grapes?  
🎠¿Te gustan los tiovivos?  
Do you like merry-go-rounds?  
🧃¿Prefieres jugo o leche?  
Do you prefer juice or milk?  
🎯¿Eres bueno en dardos?  
Are you good at darts?  
🦁¿Te gustan los leones?  
Do you like lions?  
🎤¿Has cantado en un micrófono?  
Have you sung into a microphone?  
🍿¿Prefieres palomitas dulces o saladas?  
Do you prefer sweet or salty popcorn?  
🎨¿Pintas con acuarelas?  
Do you paint with watercolors?  
🦉¿Te gustan los búhos?  
Do you like owls?  
🎳¿Has hecho un strike en boliche?  
Have you bowled a strike?  
🍞¿Te gusta el pan tostado?  
Do you like toast?  
🎸¿Tienes una banda imaginaria?  
Do you have an imaginary band?  
🎪¿Te gustan los payasos?  
Do you like clowns?  
🍍¿Te gusta la piña en la pizza?  
Do you like pineapple on pizza?  
🎮¿Prefieres videojuegos o deportes?  
Do you prefer video games or sports?  
`,
            stories: {
                story1: `#STORY
👋 Fernando saluda a los niños.  
Fernando greets the children.  
🍎 Fernando tiene una manzana roja.  
Fernando has a red apple.  
👧 Emika mira la manzana.  
Emika looks at the apple.  
❓ "¿Qué es esto?" pregunta Emika.  
"What is this?" asks Emika.  
🗣️ "Es una manzana," dice Fernando.  
"It's an apple," says Fernando.  
😋 Emika prueba la manzana.  
Emika tastes the apple.  
👍 "¡Me gusta!" dice Emika.  
"I like it!" says Emika.  
🍏 Fernando muestra una manzana verde.  
Fernando shows a green apple.  
🤔 Emika mira las dos manzanas.  
Emika looks at the two apples.  
😊 Fernando sonríe.  
Fernando smiles.  

#QUESTIONS
🍎 ¿Te gustan las manzanas rojas?  
Do you like red apples?  
🍏 ¿Prefieres manzanas verdes o rojas?  
Do you prefer green or red apples?  
👅 ¿Quieres probar una manzana?  
Do you want to try an apple?  
🗣️ ¿Puedes decir "manzana" en español?  
Can you say "apple" in Spanish?  
🎨 ¿De qué color es tu fruta favorita?  
What color is your favorite fruit?  
😋 ¿Qué frutas te gustan?  
What fruits do you like?  
👀 ¿Ves manzanas en tu escuela?  
Do you see apples at your school?  
🤲 ¿Compartes comida con amigos?  
Do you share food with friends?  
🍎 ¿Cuántas manzanas comes cada día?  
How many apples do you eat each day?  
😊 ¿Sonríes cuando comes algo rico?  
Do you smile when you eat something tasty?`,
                story2: `#STORY
🐶 María ve un perro pequeño.  
Maria sees a small dog.  
🏃 El perro corre rápido.  
The dog runs fast.  
👧 María quiere acariciar al perro.  
Maria wants to pet the dog.  
🖐️ "¿Puedo tocar?" pregunta María.  
"Can I touch?" asks Maria.  
😊 El dueño dice "Sí."  
The owner says "Yes."  
🐕 María acaricia al perro suavemente.  
Maria pets the dog gently.  
👦 Kaito y Sorato miran.  
Kaito and Sorato watch.  
🐶 El perro mueve la cola.  
The dog wags its tail.  
😄 Todos ríen.  
Everyone laughs.  
❤️ A María le encantan los perros.  
Maria loves dogs.  

#QUESTIONS
🐶 ¿Te gustan los perros?  
Do you like dogs?  
🐱 ¿Prefieres perros o gatos?  
Do you prefer dogs or cats?  
🏃 ¿Puedes correr rápido como un perro?  
Can you run fast like a dog?  
🖐️ ¿Tocas animales con cuidado?  
Do you touch animals gently?  
🎨 ¿De qué color es tu animal favorito?  
What color is your favorite animal?  
😊 ¿Sonríes cuando ves un perro?  
Do you smile when you see a dog?  
👀 ¿Ves perros en tu barrio?  
Do you see dogs in your neighborhood?  
🐕 ¿Tienes una mascota?  
Do you have a pet?  
🤔 ¿Qué animal quieres tocar?  
What animal do you want to touch?  
❤️ ¿Qué animal te encanta?  
What animal do you love?`,
                story3: `#STORY
🎂 Es el cumpleaños de Haruki.  
It's Haruki's birthday.  
🎈 Hay globos de colores.  
There are colorful balloons.  
🍰 Fernando trae un pastel grande.  
Fernando brings a big cake.  
🕯️ Siete velas están en el pastel.  
Seven candles are on the cake.  
👧 Emika canta "Feliz Cumpleaños."  
Emika sings "Happy Birthday."  
😊 Haruki sonríe mucho.  
Haruki smiles a lot.  
👏 Todos aplauden.  
Everyone claps.  
🎁 Haruki abre los regalos.  
Haruki opens the presents.  
✏️ Hay un nuevo lápiz azul.  
There is a new blue pencil.  
❤️ Haruki está muy feliz.  
Haruki is very happy.  

#QUESTIONS
🎂 ¿Cuándo es tu cumpleaños?  
When is your birthday?  
🎈 ¿Te gustan los globos?  
Do you like balloons?  
🍰 ¿Prefieres pastel de chocolate o vainilla?  
Do you prefer chocolate or vanilla cake?  
🕯️ ¿Cuántas velas hay en tu pastel?  
How many candles are on your cake?  
🎁 ¿Qué regalo quieres?  
What present do you want?  
👏 ¿Te gusta aplaudir?  
Do you like to clap?  
😊 ¿Sonríes en tu cumpleaños?  
Do you smile on your birthday?  
✏️ ¿Qué color de lápiz te gusta?  
What color pencil do you like?  
👫 ¿Con quién celebras tu cumpleaños?  
Who do you celebrate your birthday with?  
❤️ ¿Qué te hace feliz?  
What makes you happy?`,
                story4: `#STORY
☀️ Hace sol en el parque.  
It's sunny in the park.  
🌳 Emika y María juegan bajo un árbol.  
Emika and Maria play under a tree.  
🦋 Una mariposa azul vuela.  
A blue butterfly flies.  
👧 "¡Mira!" dice María.  
"Look!" says Maria.  
🏃 Las niñas corren tras la mariposa.  
The girls run after the butterfly.  
🌸 La mariposa se posa en una flor.  
The butterfly lands on a flower.  
📸 Fernando toma una foto.  
Fernando takes a picture.  
😊 Las niñas observan en silencio.  
The girls watch quietly.  
🦋 La mariposa vuela lejos.  
The butterfly flies away.  
👋 "Adiós, mariposa," dicen.  
"Goodbye, butterfly," they say.  

#QUESTIONS
🦋 ¿Te gustan las mariposas?  
Do you like butterflies?  
🎨 ¿Qué color de mariposa prefieres?  
What color butterfly do you prefer?  
🏃 ¿Corres en el parque?  
Do you run in the park?  
🌸 ¿Ves flores en el parque?  
Do you see flowers in the park?  
☀️ ¿Te gusta cuando hace sol?  
Do you like it when it's sunny?  
👀 ¿Qué animales ves en el parque?  
What animals do you see in the park?  
📸 ¿Te gusta tomar fotos?  
Do you like to take pictures?  
😊 ¿Observas la naturaleza?  
Do you observe nature?  
👫 ¿Con quién juegas en el parque?  
Who do you play with in the park?  
👋 ¿Dices "adiós" a los animales?  
Do you say "goodbye" to animals?`,
                story5: `#STORY
📚 Fernando lee un cuento.  
Fernando reads a story.  
👧👦 Los niños escuchan.  
The children listen.  
🦁 El cuento es sobre un león.  
The story is about a lion.  
😮 Los ojos de María se abren grandes.  
Maria's eyes open wide.  
🗣️ "¡Rugido!" hace Fernando.  
"Roar!" says Fernando.  
😂 Todos ríen.  
Everyone laughs.  
🖍️ Emika dibuja el león.  
Emika draws the lion.  
🎨 Usa crayones amarillos.  
She uses yellow crayons.  
👍 Fernando muestra el dibujo.  
Fernando shows the drawing.  
👏 Todos aplauden.  
Everyone claps.  

#QUESTIONS
📚 ¿Te gustan los cuentos?  
Do you like stories?  
🦁 ¿Qué animal te gusta en los cuentos?  
What animal do you like in stories?  
🗣️ ¿Puedes hacer el sonido de un león?  
Can you make a lion sound?  
🎨 ¿Te gusta dibujar?  
Do you like to draw?  
🖍️ ¿Qué color usas mucho?  
What color do you use a lot?  
👂 ¿Escuchas cuentos en la escuela?  
Do you listen to stories at school?  
😮 ¿Te sorprenden los cuentos?  
Do stories surprise you?  
👏 ¿Aplaudes cuando algo es bueno?  
Do you clap when something is good?  
📖 ¿Quién te lee cuentos?  
Who reads you stories?  
❤️ ¿Cuál es tu cuento favorito?  
What's your favorite story?`,
                story6: `#STORY
🎵 Fernando toca la guitarra.  
Fernando plays the guitar.  
👧 Emika canta una canción.  
Emika sings a song.  
👏 Los niños aplauden.  
The children clap.  
🪑 María se balancea en su silla.  
Maria rocks in her chair.  
🎶 Kaito toca las palmas.  
Kaito claps to the rhythm.  
😊 Sorato sonríe y baila.  
Sorato smiles and dances.  
🎤 Fernando canta más fuerte.  
Fernando sings louder.  
👫 Todos cantan juntos.  
Everyone sings together.  
🎉 Es muy divertido.  
It's very fun.  
❤️ A todos les encanta la música.  
Everyone loves music.  

#QUESTIONS
🎵 ¿Te gusta la música?  
Do you like music?  
🎤 ¿Cantas en la escuela?  
Do you sing at school?  
👏 ¿Sigues el ritmo con palmas?  
Do you clap to the rhythm?  
🪑 ¿Te mueves con la música?  
Do you move to the music?  
🎶 ¿Qué instrumento te gusta?  
What instrument do you like?  
😊 ¿Sonríes cuando escuchas música?  
Do you smile when you hear music?  
👫 ¿Cantas con tus amigos?  
Do you sing with your friends?  
🎉 ¿Es divertido cantar?  
Is singing fun?  
❤️ ¿Qué canción te encanta?  
What song do you love?  
🎵 ¿Quién toca música en tu familia?  
Who plays music in your family?`,
                story7: `#STORY
🌧️ Está lloviendo hoy.  
It's raining today.  
☔ Emika usa un paraguas amarillo.  
Emika uses a yellow umbrella.  
👢 María lleva botas de agua.  
Maria wears rain boots.  
💦 Los niños saltan en los charcos.  
The children jump in puddles.  
😂 Fernando se ríe.  
Fernando laughs.  
🌈 Aparece un arcoíris.  
A rainbow appears.  
👧 "¡Mira!" grita Emika.  
"Look!" shouts Emika.  
📸 Fernando toma otra foto.  
Fernando takes another picture.  
🌧️ La lluvia se detiene.  
The rain stops.  
😊 Todos están contentos.  
Everyone is happy.  

#QUESTIONS
🌧️ ¿Te gusta la lluvia?  
Do you like rain?  
☔ ¿Tienes un paraguas?  
Do you have an umbrella?  
👢 ¿Usas botas de agua?  
Do you wear rain boots?  
💦 ¿Saltas en los charcos?  
Do you jump in puddles?  
🌈 ¿Has visto un arcoíris?  
Have you seen a rainbow?  
🎨 ¿Cuántos colores tiene el arcoíris?  
How many colors does a rainbow have?  
😊 ¿Estás contento cuando sale el sol?  
Are you happy when the sun comes out?  
📸 ¿Te gusta tomar fotos de la naturaleza?  
Do you like taking pictures of nature?  
👫 ¿Juegas bajo la lluvia con amigos?  
Do you play in the rain with friends?  
🌧️ ¿Qué haces en días lluviosos?  
What do you do on rainy days?`,
                story8: `#STORY
🚌 Los niños van de excursión.  
The children go on a field trip.  
🏛️ Visitan un museo.  
They visit a museum.  
🦖 Ven dinosaurios grandes.  
They see big dinosaurs.  
😮 Kaito abre mucho los ojos.  
Kaito's eyes open wide.  
📝 Sorato escribe en su cuaderno.  
Sorato writes in his notebook.  
📸 Fernando toma muchas fotos.  
Fernando takes many pictures.  
🛍️ Emika compra un recuerdo.  
Emika buys a souvenir.  
🚌 Regresan al autobús.  
They return to the bus.  
😴 María está cansada.  
Maria is tired.  
😊 Pero todos están felices.  
But everyone is happy.  

#QUESTIONS
🚌 ¿Te gustan las excursiones?  
Do you like field trips?  
🏛️ ¿Qué lugar quieres visitar?  
What place do you want to visit?  
🦖 ¿Te gustan los dinosaurios?  
Do you like dinosaurs?  
📝 ¿Escribes sobre tus viajes?  
Do you write about your trips?  
📸 ¿Te gusta tomar fotos en excursiones?  
Do you like taking pictures on trips?  
🛍️ ¿Compras recuerdos?  
Do you buy souvenirs?  
😴 ¿Te cansas en las excursiones?  
Do you get tired on field trips?  
😊 ¿Qué te hace feliz en los viajes?  
What makes you happy on trips?  
👫 ¿Con quién vas de excursión?  
Who do you go on trips with?  
🚌 ¿Qué transporte usas?  
What transportation do you use?`,
                story9: `#STORY
🏫 Es el primer día de escuela.  
It's the first day of school.  
👧 María está nerviosa.  
Maria is nervous.  
👦 Kaito y Sorato sonríen.  
Kaito and Sorato smile.  
🖍️ Hay crayones nuevos.  
There are new crayons.  
📚 Fernando muestra los libros.  
Fernando shows the books.  
🎵 Cantan una canción.  
They sing a song.  
👫 Emika ayuda a María.  
Emika helps Maria.  
😊 María ya no está nerviosa.  
Maria isn't nervous anymore.  
✏️ Todos escriben sus nombres.  
Everyone writes their names.  
❤️ Es un buen primer día.  
It's a good first day.  

#QUESTIONS
🏫 ¿Te gusta la escuela?  
Do you like school?  
🖍️ ¿Qué material escolar te gusta?  
What school supply do you like?  
📚 ¿Te gustan los libros nuevos?  
Do you like new books?  
🎵 ¿Cantas en la escuela?  
Do you sing at school?  
👫 ¿Ayudas a tus compañeros?  
Do you help your classmates?  
😊 ¿Estabas nervioso el primer día?  
Were you nervous on the first day?  
✏️ ¿Puedes escribir tu nombre?  
Can you write your name?  
❤️ ¿Qué te gusta de la escuela?  
What do you like about school?  
👦 ¿Quién es tu primer amigo?  
Who is your first friend?  
🏫 ¿Qué haces en la escuela?  
What do you do at school?`,
                story10: `#STORY
🎄 Es Navidad.  
It's Christmas.  
🎁 Hay regalos bajo el árbol.  
There are presents under the tree.  
👧 María abre su regalo.  
Maria opens her present.  
🦖 ¡Es un dinosaurio de peluche!  
It's a stuffed dinosaur!  
❤️ María lo abraza.  
Maria hugs it.  
👦 Kaito recibe un balón.  
Kaito gets a ball.  
⚽ Sorato recibe unos guantes.  
Sorato gets some gloves.  
🎶 Cantan villancicos.  
They sing carols.  
🍪 Comen galletas.  
They eat cookies.  
😊 Todos están felices.  
Everyone is happy.  

#QUESTIONS
🎄 ¿Te gusta la Navidad?  
Do you like Christmas?  
🎁 ¿Qué regalo quieres?  
What present do you want?  
🦖 ¿Te gustan los dinosaurios?  
Do you like dinosaurs?  
❤️ ¿Abrazas tus regalos?  
Do you hug your presents?  
🎶 ¿Cantas en Navidad?  
Do you sing at Christmas?  
🍪 ¿Qué comida te gusta en Navidad?  
What food do you like at Christmas?  
😊 ¿Estás feliz en Navidad?  
Are you happy at Christmas?  
👫 ¿Con quién celebras?  
Who do you celebrate with?  
🎄 ¿Qué ves en Navidad?  
What do you see at Christmas?  
❤️ ¿Qué es lo mejor de Navidad?  
What's the best thing about Christmas?`
            }
        };

        // Global variables
        let currentContentType = null;
        let currentStory = null;
        let sentences = [];
        let currentSentenceIndex = 0;
        let fruitGameEnabled = false;
        let fruitGameActive = false;
        let shouldAdvanceAfterGame = false;
        let isNightMode = false;

        // DOM elements
        const mainContainer = document.getElementById('mainContainer');
        const readingModeContainer = document.getElementById('readingModeContainer');
        const spanishSentence = document.getElementById('spanishSentence');
        const englishSentence = document.getElementById('englishSentence');
        const prevSentenceBtn = document.getElementById('prevSentence');
        const nextSentenceBtn = document.getElementById('nextSentence');
        const playSpanishBtn = document.getElementById('playSpanish');
        const playEnglishBtn = document.getElementById('playEnglish');
        const exitReadingBtn = document.getElementById('exitReading');
        const fruitToggleBtn = document.getElementById('fruitToggle');
        const contentSelector = document.getElementById('contentSelector');
        const storySelector = document.getElementById('storySelector');
        const nightModeToggle = document.getElementById('nightModeToggle');
        
        // Initialize the app
        function init() {
            // Set up event listeners
            contentSelector.addEventListener('change', handleContentSelect);
            storySelector.addEventListener('change', handleStorySelect);

            nightModeToggle.addEventListener('click', toggleNightMode);
            prevSentenceBtn.addEventListener('click', showPreviousSentence);
            nextSentenceBtn.addEventListener('click', showNextSentence);
            playSpanishBtn.addEventListener('click', () => playSentence('spanish'));
            playEnglishBtn.addEventListener('click', () => playSentence('english'));
            exitReadingBtn.addEventListener('click', exitReadingMode);
            fruitToggleBtn.addEventListener('click', toggleFruitGame);

            // Initialize translation elements
            initTranslationElements();
            
            // Set up keyboard navigation for TV remote
            document.addEventListener('keydown', handleRemoteInput);
            
            // Load voices when they become available
            if ('speechSynthesis' in window) {
                window.speechSynthesis.onvoiceschanged = function() {
                    console.log('Voices loaded');
                };
                
                // Some browsers need this to load voices
                if (window.speechSynthesis.getVoices().length === 0) {
                    window.speechSynthesis.getVoices();
                }
            }
            
            // Focus the content selector
            contentSelector.focus();
        }
        
function updatePageCounter() {
    if (!sentences || sentences.length === 0) return;
    
    document.getElementById('currentPage').textContent = currentSentenceIndex + 1;
    document.getElementById('totalPages').textContent = sentences.length;
}

        function toggleNightMode() {
            isNightMode = !isNightMode;
            document.body.classList.toggle('dark-mode', isNightMode);
            nightModeToggle.textContent = isNightMode ? '☀️' : '🌙';
            
            // Save preference to localStorage
            localStorage.setItem('nightMode', isNightMode);
        }
        
        function handleContentSelect() {
            currentContentType = this.value;
            storySelector.disabled = (currentContentType !== 'stories');
            
            if (currentContentType === 'stories') {
                populateStorySelector();
            } else if (currentContentType === 'questions') {
                // Enter reading mode for questions
                enterReadingMode();
            } else {
                storySelector.innerHTML = '<option value="">Select Story</option>';
                storySelector.disabled = true;
            }
        }
        
function handleStorySelect() {
    currentStory = this.value;
    
    if (currentStory) {
        enterReadingMode();
    }
}
        
        function populateStorySelector() {
            storySelector.innerHTML = '<option value="">Select Story</option>';
            for (let i = 1; i <= 10; i++) {
                const option = document.createElement('option');
                option.value = `story${i}`;
                option.textContent = `Story ${i}`;
                storySelector.appendChild(option);
            }
            storySelector.disabled = false;
            storySelector.focus();
        }
        
        // Enter reading mode
        function enterReadingMode() {
            // Hide main container and show reading container
            mainContainer.style.display = 'none';
            readingModeContainer.style.display = 'flex';
            
            // Initialize translation events
            initTranslationEvents();
            
            // Load the content
            loadTextContent();
        }
        
        // Exit reading mode
        function exitReadingMode() {
            // Show main container and hide reading container
            mainContainer.style.display = 'block';
            readingModeContainer.style.display = 'none';
            
            // Stop any speech
            stopSpeech();
            
            // Focus the content selector
            setTimeout(() => {
                contentSelector.focus();
            }, 100);
        }
        
        // Load text content for reading mode
function loadTextContent() {
    let content;
    if (currentContentType === 'questions') {
        content = spanishContent.questions;
    } else if (currentContentType === 'stories' && currentStory) {
        content = spanishContent.stories[currentStory];
    } else {
        alert('Content not available');
        exitReadingMode();
        return;
    }

    sentences = parseStoryFile(content);
    if (sentences.length > 0) {
        currentSentenceIndex = 0;
        updatePageCounter();
        displayCurrentSentence();
    } else {
        alert('No sentences found');
        exitReadingMode();
    }
}
        
        // Parse story file content
        function parseStoryFile(text) {
            const lines = text.split('\n')
                .map(line => line.trim())
                .filter(line => line.length > 0 && !line.startsWith('#'));
            
            const result = [];
            let spanishLine = null;
            
            for (const line of lines) {
                // Spanish line has emojis or Spanish characters
                if (/[a-zA-ZáéíóúÁÉÍÓÚñÑ¿¡]/.test(line)) {
                    if (!spanishLine) {
                        spanishLine = line;
                    } else {
                        // English line (following a Spanish line)
                        result.push({
                            spanish: spanishLine,
                            english: line,
                            number: result.length + 1
                        });
                        spanishLine = null;
                    }
                }
            }
            
            return result;
        }
        
        function ensureTextVisibility() {
            const rows = document.querySelectorAll('.sentence-row');
            rows.forEach(row => {
                const display = row.querySelector('.sentence-display');
                if (display.scrollHeight > display.clientHeight) {
                    // Reduce font size until text fits
                    let fontSize = parseFloat(window.getComputedStyle(display).fontSize);
                    while (display.scrollHeight > display.clientHeight && fontSize > 24) {
                        fontSize -= 1;
                        display.style.fontSize = `${fontSize}px`;
                    }
                }
            });
        }
        
        // Display current sentence
function displayCurrentSentence() {
    if (!sentences || sentences.length === 0) {
        spanishSentence.textContent = "No sentences loaded";
        englishSentence.textContent = "";
        return;
    }

    const sentence = sentences[currentSentenceIndex];
    
    // Remove emoji from display if it's at the start of the sentence
    let spanishText = sentence.spanish;
    const emojiRegex = /^(\p{Emoji_Presentation}|\p{Extended_Pictographic})/u;
    if (emojiRegex.test(spanishText)) {
        // Find the first emoji character
        const emojiMatch = spanishText.match(emojiRegex);
        if (emojiMatch && emojiMatch[0]) {
            spanishText = spanishText.substring(emojiMatch[0].length).trim();
        }
    }
    
    spanishSentence.textContent = `${sentence.number}. ${spanishText}`;
    englishSentence.textContent = `${sentence.number}. ${sentence.english}`;
    
    // Update button states - Never disable navigation buttons
    prevSentenceBtn.disabled = false;
    nextSentenceBtn.disabled = false;
    setTimeout(ensureTextVisibility, 50);
    updatePageCounter(); 
}
    
        // Play sentence audio
function playSentence(type) {
    if (sentences.length === 0 || fruitGameActive) return;
    
    const sentence = sentences[currentSentenceIndex];
    let text = type === 'spanish' ? sentence.spanish : sentence.english;
    const lang = type === 'spanish' ? 'es-ES' : 'en-US';
    
    // Remove emoji from text to be spoken
    const emojiRegex = /(\p{Emoji_Presentation}|\p{Extended_Pictographic})/gu;
    text = text.replace(emojiRegex, '').trim();
    
    // Stop any current speech and sounds
    stopSpeech();
    
    // Speak the sentence
    speakSentence(text, lang);
}
 function stopSpeech() {
    if ('speechSynthesis' in window) {
        window.speechSynthesis.cancel();
    }
}    
   
        // Text-to-speech function
function speakSentence(text, lang) {
    if (!('speechSynthesis' in window)) {
        console.warn('Speech synthesis not supported');
        return;
    }

    // Stop any current speech
    stopSpeech();

    // Create new utterance
    const utterance = new SpeechSynthesisUtterance(text);
    
    // Set language and voice properties
    utterance.lang = lang;
    utterance.rate = 0.9;
    utterance.pitch = 1;
    utterance.volume = 1;

    // Function to actually speak once voices are loaded
    const speakWithVoice = () => {
        const voices = window.speechSynthesis.getVoices();
        
        // Find the appropriate voice
        let voice;
        if (lang === 'es-ES') {
            // Find a Spanish voice
            voice = voices.find(v => 
                v.lang === 'es-ES' || 
                v.lang.startsWith('es')
            );
        } else if (lang === 'en-US') {
            // Find an English voice
            voice = voices.find(v => 
                v.lang === 'en-US' || 
                v.lang.startsWith('en')
            );
        }

        if (voice) {
            utterance.voice = voice;
            console.log('Using voice:', voice.name, 'for language:', lang);
        } else {
            console.warn('No specific voice found for', lang, 'using default');
        }

        // Error handling
        utterance.onerror = function(event) {
            console.error('SpeechSynthesis error:', event);
        };

        // Speak immediately
        window.speechSynthesis.speak(utterance);
    };

    // Check if voices are loaded
    const voices = window.speechSynthesis.getVoices();
    if (voices.length === 0) {
        console.log('Waiting for voices to load...');
        window.speechSynthesis.onvoiceschanged = speakWithVoice;
    } else {
        speakWithVoice();
    }
}
        // Navigation functions
function showNextSentence() {
    stopSpeech();
    closeTranslationPopupHandler();
    
    if (sentences.length === 0 || fruitGameActive) return;
    
    const isLastPage = currentSentenceIndex >= sentences.length - 1;
    
    // Always allow fruit game if enabled
    if (fruitGameEnabled) {
        shouldAdvanceAfterGame = true; // Always set to true - we'll handle last page in hideFruitGame
        showFruitGame();
        return;
    }
    
    // Handle last page case (only when fruit game is off)
    if (isLastPage) {
        currentSentenceIndex = 0; // Loop to beginning
        displayCurrentSentence();
        return;
    }
    
    // Normal case - go to next sentence
    advanceToNextSentence();
}
        function advanceToNextSentence() {
            if (currentSentenceIndex < sentences.length - 1) {
                currentSentenceIndex++;
            } else {
                currentSentenceIndex = 0; // Loop to beginning
            }
            
            displayCurrentSentence();
 updatePageCounter();
        }
        
function showPreviousSentence() {
    stopSpeech();
    closeTranslationPopupHandler(); // Close any open translation popup
    
    if (sentences.length === 0) return;
    
    if (currentSentenceIndex > 0) {
        currentSentenceIndex--;
    } else {
        currentSentenceIndex = sentences.length - 1; // Loop to end
    }
    
    displayCurrentSentence();
 updatePageCounter(); 
}
       
        // Handle TV remote input
        function handleRemoteInput(e) {
            const activeElement = document.activeElement;
            
            switch(e.key) {
                case 'ArrowUp':
                    navigateFocus('up');
                    e.preventDefault();
                    break;
                case 'ArrowDown':
                    navigateFocus('down');
                    e.preventDefault();
                    break;
                case 'ArrowLeft':
                    if (activeElement === prevSentenceBtn) {
                        showPreviousSentence();
                    } else {
                        navigateFocus('left');
                    }
                    e.preventDefault();
                    break;
                case 'ArrowRight':
                    if (activeElement === nextSentenceBtn) {
                        showNextSentence();
                    } else {
                        navigateFocus('right');
                    }
                    e.preventDefault();
                    break;
                case 'Enter':
                    if (activeElement) {
                        activeElement.click();
                    }
                    break;
                case 'Backspace':
                    exitReadingMode();
                    break;
            }
        }
        
        // Navigate focus between elements
        function navigateFocus(direction) {
            const focusable = Array.from(document.querySelectorAll('button, select, [tabindex="0"]'));
            const currentIndex = focusable.indexOf(document.activeElement);
            
            if (currentIndex === -1) {
                if (focusable.length > 0) focusable[0].focus();
                return;
            }
            
            let nextIndex = currentIndex;
            
            // Simple navigation - can be enhanced for grid layouts
            if (direction === 'up' || direction === 'left') {
                nextIndex = Math.max(0, currentIndex - 1);
            } else {
                nextIndex = Math.min(focusable.length - 1, currentIndex + 1);
            }
            
            focusable[nextIndex].focus();
        }
        
// Translation state variables
let translationPopup, translationOverlay, closeTranslationPopup;
let translationOriginal, translationResult, translationTts;
let selectedText = '';
let translationLang = '';

// Initialize translation elements
function initTranslationElements() {
    translationPopup = document.getElementById('translationPopup');
    translationOverlay = document.getElementById('translationOverlay');
    closeTranslationPopup = document.getElementById('closeTranslationPopup');
    translationOriginal = document.getElementById('translationOriginal');
    translationResult = document.getElementById('translationResult');
    translationTts = document.getElementById('translationTts');
    
    if (!translationPopup || !translationOverlay || !closeTranslationPopup || 
        !translationOriginal || !translationResult || !translationTts) {
        console.error('One or more translation elements not found');
        return false;
    }
    
    // Reset state
    selectedText = '';
    translationLang = '';
    return true;
}

// Show translation popup
function showTranslationPopup(text, lang) {
    // Validate input
    const trimmedText = text.trim();
    if (!trimmedText || trimmedText.length < 1 || trimmedText.toLowerCase() === 'translate') {
        return;
    }
    
    // Reset previous state
    closeTranslationPopupHandler();
    
    // Set new translation data
    selectedText = trimmedText;
    translationLang = lang;
    
    // Update UI labels based on translation direction
    const sourceLabel = document.getElementById('sourceLanguageLabel');
    const targetLabel = document.getElementById('targetLanguageLabel');
    
    if (lang === 'es') {
        sourceLabel.textContent = 'Spanish:';
        targetLabel.textContent = 'English:';
    } else {
        sourceLabel.textContent = 'English:';
        targetLabel.textContent = 'Spanish:';
    }
    
    // Highlight the selected text
    try {
        const selection = window.getSelection();
        if (selection.rangeCount > 0) {
            const range = selection.getRangeAt(0);
            const span = document.createElement('span');
            span.className = 'highlighted-text';
            span.style.backgroundColor = 'rgba(255, 255, 0, 0.3)';
            range.surroundContents(span);
        }
    } catch (e) {
        console.error('Error highlighting text:', e);
    }
    
    // Update UI with original text
    translationOriginal.textContent = selectedText;
    translationResult.textContent = "Loading translation...";    
    // Update UI with original text
    translationOriginal.textContent = selectedText;
    translationResult.textContent = "Loading translation...";
    
    // Show popup
    translationPopup.classList.add('active');
    translationOverlay.classList.add('active');
    
    // Fetch translation
    fetchTranslation(selectedText, lang);
    
    // Add event listener to close popup when clicking Next button
    const nextBtn = document.getElementById('nextSentence');
    const prevBtn = document.getElementById('prevSentence');
    
    const closeOnNav = () => {
        closeTranslationPopupHandler();
        nextBtn.removeEventListener('click', closeOnNav);
        prevBtn.removeEventListener('click', closeOnNav);
    };
    
    nextBtn.addEventListener('click', closeOnNav);
    prevBtn.addEventListener('click', closeOnNav);
}

function closeTranslationPopupHandler() {
    if (!translationPopup || !translationOverlay) return;
    
    translationPopup.classList.remove('active');
    translationOverlay.classList.remove('active');
    stopSpeech();
    
    // Clear the translation fields
    translationOriginal.textContent = '';
    translationResult.textContent = '';
    
    // Reset selection state
    if (window.getSelection) {
        window.getSelection().removeAllRanges();
    }
    
    // Remove all highlights and restore original text
    document.querySelectorAll('.highlighted-text').forEach(el => {
        const parent = el.parentNode;
        while (el.firstChild) {
            parent.insertBefore(el.firstChild, el);
        }
        parent.removeChild(el);
        parent.normalize(); // Combine adjacent text nodes
    });
    
    // Reset translation variables
    selectedText = '';
    translationLang = '';
}

// Fetch translation from a free API
function fetchTranslation(text, lang) {
    // Correct format is "es|en" or "en|es"
    const langPair = lang === 'es' ? 'es|en' : 'en|es';
    
    // Encode the text and language pair properly
    const encodedText = encodeURIComponent(text);
    const encodedLangPair = encodeURIComponent(langPair);
    
    // Build the API URL
    const apiUrl = `https://api.mymemory.translated.net/get?q=${encodedText}&langpair=${encodedLangPair}`;
    
    // Use a reliable CORS proxy
    const proxyUrl = 'https://corsproxy.io/?';
    
    fetch(proxyUrl + apiUrl)
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            if (data.responseData && data.responseData.translatedText) {
                // Clean the translated text
                let translatedText = data.responseData.translatedText;
                
                // Remove unwanted characters and formatting
                translatedText = translatedText
                    .replace(/[#*_~`^]/g, '') // Remove special formatting chars
                    .replace(/\{.*?\}/g, '')   // Remove {tags}
                    .replace(/\[.*?\]/g, '')   // Remove [tags]
                    .replace(/\(.*?\)/g, '')   // Remove (tags)
                    .replace(/\d+/g, '')       // Remove numbers
                    .trim();
                
                // If the result is empty after cleaning, show an error
                if (!translatedText) {
                    throw new Error('Translation returned empty after cleaning');
                }
                
                translationResult.textContent = translatedText;
            } else {
                throw new Error('No translation data received');
            }
        })
        .catch(error => {
            console.error('Translation error:', error);
            translationResult.textContent = "Unable to get translation";
        });
}
 // Handle text selection - CORRECTED VERSION
        function handleTextSelection() {
            try {
                const selection = window.getSelection();
                if (!selection || selection.isCollapsed || selection.rangeCount === 0) {
                    return;
                }

                const selectedText = selection.toString().trim();
                if (!selectedText || selectedText.length < 1 || selectedText.toLowerCase() === 'translate') {
                    return;
                }

                const range = selection.getRangeAt(0);
                const container = range.commonAncestorContainer;

                // Check if selection is within our target elements
                const isSpanish = spanishSentence.contains(container);
                const isEnglish = englishSentence.contains(container);
                if (!isSpanish && !isEnglish) {
                    closeTranslationPopupHandler();
                    return;
                }

                // Skip if selection is collapsed (no actual text)
                if (range.collapsed) {
                    closeTranslationPopupHandler();
                    return;
                }

                // Show translation immediately for the selected text
                showTranslationPopup(selectedText, isSpanish ? 'es' : 'en');
            } catch (error) {
                console.error('Error in text selection handling:', error);
            }
        }
        
function initTranslationEvents() {
    // Initialize translation elements first
    if (!initTranslationElements()) return;

    // Click event for single words
    spanishSentence.addEventListener('click', handleSpanishClick);
    englishSentence.addEventListener('click', handleEnglishClick);
    
    // Selection event for phrases
    document.addEventListener('mouseup', handleTextSelection);
    
    // Close popup events
    closeTranslationPopup.addEventListener('click', closeTranslationPopupHandler);
    translationOverlay.addEventListener('click', closeTranslationPopupHandler);
    
    // TTS button
    translationTts.addEventListener('click', () => {
        if (selectedText && translationLang) {
            speakSentence(selectedText, translationLang === 'es' ? 'es-ES' : 'en-US');
        }
    });
}

function handleSpanishClick(e) {
    if (e.target === spanishSentence) {
        const word = getWordAtPoint(spanishSentence, e.clientX, e.clientY);
        if (word) {
            showTranslationPopup(word, 'es');
        }
    }
}

function handleEnglishClick(e) {
    if (e.target === englishSentence) {
        const word = getWordAtPoint(englishSentence, e.clientX, e.clientY);
        if (word) {
            showTranslationPopup(word, 'en');
        }
    }
}

        // Helper function to get word at specific coordinates
        function getWordAtPoint(element, x, y) {
            const range = document.caretRangeFromPoint(x, y);
            if (!range) return null;
            
            range.expand('word');
            const word = range.toString().trim();
            return word || null;
        }
        
        // Fruit game categories - ALL IN SPANISH
        const categories = [
            { 
                name: 'Frutas', 
                items: [
                    {emoji: '🍎', name: 'Manzana'}, 
                    {emoji: '🍊', name: 'Naranja'},
                    {emoji: '🍇', name: 'Uvas'},
                    {emoji: '🍋', name: 'Limón'},
                    {emoji: '🍉', name: 'Sandía'},
                    {emoji: '🍓', name: 'Fresa'},
                    {emoji: '🍒', name: 'Cereza'},
                    {emoji: '🍑', name: 'Melocotón'},
                    {emoji: '🍍', name: 'Piña'},
                    {emoji: '🥝', name: 'Kiwi'}
                ]
            },
            { 
                name: 'Verduras', 
                items: [
                    {emoji: '🥕', name: 'Zanahoria'},
                    {emoji: '🥦', name: 'Brócoli'},
                    {emoji: '🍅', name: 'Tomate'},
                    {emoji: '🥒', name: 'Pepino'},
                    {emoji: '🌽', name: 'Maíz'},
                    {emoji: '🍆', name: 'Berenjena'},
                    {emoji: '🥬', name: 'Lechuga'},
                    {emoji: '🧅', name: 'Cebolla'},
                    {emoji: '🧄', name: 'Ajo'},
                    {emoji: '🥔', name: 'Papa'}
                ]
            },
            { 
                name: 'Naturaleza', 
                items: [
                    {emoji: '🌲', name: 'Árbol'},
                    {emoji: '🌵', name: 'Cactus'},
                    {emoji: '🌊', name: 'Ola'},
                    {emoji: '⛰️', name: 'Montaña'},
                    {emoji: '🌋', name: 'Volcán'},
                    {emoji: '🏝️', name: 'Isla'},
                    {emoji: '🌅', name: 'Amanecer'},
                    {emoji: '🌈', name: 'Arcoíris'},
                    {emoji: '❄️', name: 'Copo de nieve'},
                    {emoji: '🌪️', name: 'Tornado'}
                ]
            },
            { 
                name: 'Animales', 
                items: [
                    {emoji: '🐶', name: 'Perro'},
                    {emoji: '🐱', name: 'Gato'},
                    {emoji: '🦁', name: 'León'},
                    {emoji: '🐯', name: 'Tigre'},
                    {emoji: '🦊', name: 'Zorro'},
                    {emoji: '🐻', name: 'Oso'},
                    {emoji: '🐼', name: 'Panda'},
                    {emoji: '🐨', name: 'Koala'},
                    {emoji: '🐵', name: 'Mono'},
                    {emoji: '🦄', name: 'Unicornio'}
                ]
            },
            { 
                name: 'Comida', 
                items: [
                    {emoji: '🍕', name: 'Pizza'},
                    {emoji: '🍔', name: 'Hamburguesa'},
                    {emoji: '🌭', name: 'Perrito caliente'},
                    {emoji: '🍟', name: 'Papas fritas'},
                    {emoji: '🍣', name: 'Sushi'},
                    {emoji: '🍩', name: 'Dona'},
                    {emoji: '🍪', name: 'Galleta'},
                    {emoji: '🍿', name: 'Palomitas'},
                    {emoji: '🍦', name: 'Helado'},
                    {emoji: '🍫', name: 'Chocolate'}
                ]
            },
            { 
                name: 'Deportes', 
                items: [
                    {emoji: '⚽', name: 'Fútbol'},
                    {emoji: '🏀', name: 'Baloncesto'},
                    {emoji: '🏈', name: 'Fútbol americano'},
                    {emoji: '⚾', name: 'Béisbol'},
                    {emoji: '🎾', name: 'Tenis'},
                    {emoji: '🏐', name: 'Voleibol'},
                    {emoji: '🎱', name: 'Billar'},
                    {emoji: '🏓', name: 'Ping Pong'},
                    {emoji: '🏸', name: 'Bádminton'},
                    {emoji: '🥊', name: 'Boxeo'}
                ]
            },
            { 
                name: 'Vehículos', 
                items: [
                    {emoji: '🚗', name: 'Coche'},
                    {emoji: '🚕', name: 'Taxi'},
                    {emoji: '🚙', name: 'Camioneta'},
                    {emoji: '🚌', name: 'Autobús'},
                    {emoji: '🚑', name: 'Ambulancia'},
                    {emoji: '🚒', name: 'Camión de bomberos'},
                    {emoji: '🚜', name: 'Tractor'},
                    {emoji: '🚲', name: 'Bicicleta'},
                    {emoji: '🛵', name: 'Scooter'},
                    {emoji: '✈️', name: 'Avión'}
                ]
            },
            { 
                name: 'Hogar', 
                items: [
                    {emoji: '🛏️', name: 'Cama'},
                    {emoji: '🛋️', name: 'Sofá'},
                    {emoji: '🚪', name: 'Puerta'},
                    {emoji: '🪑', name: 'Silla'},
                    {emoji: '🛁', name: 'Bañera'},
                    {emoji: '🚿', name: 'Ducha'},
                    {emoji: '🧻', name: 'Papel higiénico'},
                    {emoji: '🧹', name: 'Escoba'},
                    {emoji: '🧴', name: 'Loción'},
                    {emoji: '🔪', name: 'Cuchillo de cocina'}
                ]
            },
            { 
                name: 'Ropa', 
                items: [
                    {emoji: '👕', name: 'Camiseta'},
                    {emoji: '👖', name: 'Vaqueros'},
                    {emoji: '🧥', name: 'Abrigo'},
                    {emoji: '👗', name: 'Vestido'},
                    {emoji: '👔', name: 'Corbata'},
                    {emoji: '👚', name: 'Blusa'},
                    {emoji: '👟', name: 'Zapatillas'},
                    {emoji: '🧦', name: 'Calcetines'},
                    {emoji: '🧤', name: 'Guantes'},
                    {emoji: '🎩', name: 'Sombrero de copa'}
                ]
            },
            { 
                name: 'Electrónicos', 
                items: [
                    {emoji: '📱', name: 'Teléfono móvil'},
                    {emoji: '💻', name: 'Ordenador portátil'},
                    {emoji: '🖥️', name: 'Ordenador de sobremesa'},
                    {emoji: '🖨️', name: 'Impresora'},
                    {emoji: '📷', name: 'Cámara'},
                    {emoji: '🎥', name: 'Videocámara'},
                    {emoji: '📺', name: 'Televisor'},
                    {emoji: '🎮', name: 'Mando de juego'},
                    {emoji: '⌚', name: 'Reloj'},
                    {emoji: '🔌', name: 'Enchufe'}
                ]
            }
        ];

        // Fruit game functions
        function updateFruitButtonState() {
            fruitToggleBtn.textContent = fruitGameEnabled ? '🎰 Fruit Game ON' : '🎰 Fruit Game OFF';
            fruitToggleBtn.classList.toggle('on', fruitGameEnabled);
        }
        
        function toggleFruitGame() {
            fruitGameEnabled = !fruitGameEnabled;
            updateFruitButtonState();
            
            if (fruitGameEnabled) {
                playSound('activate');
                if (navigator.vibrate) navigator.vibrate(50);
            }
            
            console.log('Fruit game is now', fruitGameEnabled ? 'ON' : 'OFF');
        }
        
        function showFruitGame() {
            if (!fruitGameEnabled || fruitGameActive) {
                console.log('Fruit game not shown - enabled:', fruitGameEnabled, 'active:', fruitGameActive);
                return;
            }
            
            // Stop any current speech
            stopSpeech();
            fruitGameActive = true;
            
            // Create game container
            const gameContainer = document.createElement('div');
            gameContainer.className = 'fruit-game-container';
            gameContainer.innerHTML = `
                <div class="fruit-game">
                    <h2>Fruit Machine!</h2>
                    <div class="fruit-reels">
                        <div class="reel-container">
                            <div class="fruit-reel" id="reel1">🍎</div>
                            <div class="fruit-name" id="name1"></div>
                        </div>
                        <div class="reel-container">
                            <div class="fruit-reel" id="reel2">🍊</div>
                            <div class="fruit-name" id="name2"></div>
                        </div>
                        <div class="reel-container">
                            <div class="fruit-reel" id="reel3">🍇</div>
                            <div class="fruit-name" id="name3"></div>
                        </div>
                    </div>
                    <div id="fruitResult" style="font-size: 2rem; min-height: 60px; margin: 20px 0;"></div>
                    <button id="exitFruitGame" class="btn" style="margin-top: 20px; background-color: var(--warning);">Exit Game</button>
                </div>
            `;
            
            document.body.appendChild(gameContainer);
            
            // Spin the reels
            spinReels();
            
            // Exit button
            document.getElementById('exitFruitGame').addEventListener('click', hideFruitGame);
        }
        
function hideFruitGame() {
    const game = document.querySelector('.fruit-game-container');
    if (game) game.remove();
    fruitGameActive = false;
    
    // Stop any game sounds
    if (window.AudioContext) {
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        audioCtx.close();
    }
    
    // Ensure translation popup is closed
    closeTranslationPopupHandler();
    
    setTimeout(() => {
        if (shouldAdvanceAfterGame) {
            const isLastPage = currentSentenceIndex >= sentences.length - 1;
            if (isLastPage) {
                // If we're on last page, loop back to first page
                currentSentenceIndex = 0;
            } else {
                // Otherwise just go to next page
                advanceToNextSentence();
            }
            shouldAdvanceAfterGame = false;
        }
        displayCurrentSentence(); // Always refresh display
    }, 500);
}
        
        function spinReels() {
            // Select a random category for this spin
            const currentCategory = categories[Math.floor(Math.random() * categories.length)];
            const items = currentCategory.items;
            
            const reels = [
                document.getElementById('reel1'),
                document.getElementById('reel2'),
                document.getElementById('reel3')
            ];
            const resultDisplay = document.getElementById('fruitResult');
            
            // Reset display
            resultDisplay.textContent = '';
            resultDisplay.style.color = '';
            
            // Play spinning sound
            playSound('spin');
            
            // Determine if we should have a match (1 in 3 chance)
            const shouldMatch = Math.random() < 0.33;
            let matchingItem = '';
            
            if (shouldMatch) {
                matchingItem = items[Math.floor(Math.random() * items.length)];
                // Update the matchingItem to be the full object (not just emoji)
                matchingItem = items.find(item => item.emoji === matchingItem.emoji) || matchingItem;
            }
            
            // Spin each reel with delays between them
            spinReel(reels[0], 0, items, matchingItem, shouldMatch, () => {
                playSound('reelStop');
                spinReel(reels[1], 300, items, matchingItem, shouldMatch, () => {
                    playSound('reelStop');
                    spinReel(reels[2], 300, items, matchingItem, shouldMatch, () => {
                        playSound('reelStop');
                        
                        // Check for win after last reel stops
                        setTimeout(() => {
                            if (shouldMatch && reels[0].textContent === reels[1].textContent && 
                                reels[1].textContent === reels[2].textContent) {
                                // Win condition
                                playSound('win');
                                playSound('coin');
                                resultDisplay.textContent = '🎉 WINNER! 🎉';
                                resultDisplay.style.color = 'var(--success)';
                                resultDisplay.style.fontWeight = 'bold';
                                
                                // Celebration animation
                                reels.forEach(reel => {
                                    reel.style.transform = 'scale(1.2)';
                                    reel.style.transition = 'all 0.3s';
                                    reel.style.boxShadow = '0 0 20px gold';
                                });
                                
                                // Confetti effect
                                setTimeout(() => {
                                    createConfetti();
                                }, 500);
                                
                                setTimeout(hideFruitGame, 3000);
                            } else {
                                // Lose condition
                                playSound('lose');
                                resultDisplay.textContent = 'Try again!';
                                resultDisplay.style.color = 'var(--warning)';
                                
                                // Shake animation
                                reels.forEach(reel => {
                                    reel.style.animation = 'shake 0.5s';
                                });
                                
                                setTimeout(hideFruitGame, 2000);
                            }
                        }, 300);
                    });
                });
            });
        }
        
        // Helper function to spin a single reel
        function spinReel(reel, delay, items, matchingItem, shouldMatch, callback) {
            const reelNumber = reel.id.replace('reel', '');
            const nameElement = document.getElementById(`name${reelNumber}`);
            
            setTimeout(() => {
                let spins = 0;
                const spinInterval = setInterval(() => {
                    // For the first few spins, show random items
                    if (spins < 10) {
                        const randomItem = items[Math.floor(Math.random() * items.length)];
                        reel.textContent = randomItem.emoji;
                        nameElement.textContent = '';
                    } 
                    // Then slow down to the final result
                    else if (spins < 15) {
                        if (spins % 2 === 0) {
                            const randomItem = items[Math.floor(Math.random() * items.length)];
                            reel.textContent = randomItem.emoji;
                            nameElement.textContent = '';
                        }
                    } 
                    // Final result
                    else {
                        clearInterval(spinInterval);
                        let finalItem;
                        if (shouldMatch) {
                            finalItem = matchingItem;
                        } else {
                            finalItem = items[Math.floor(Math.random() * items.length)];
                        }
                        reel.textContent = finalItem.emoji;
                        nameElement.textContent = finalItem.name;
                        
                        // Speak the name
                        if (window.speechSynthesis) {
                            const utterance = new SpeechSynthesisUtterance(finalItem.name);
                            utterance.lang = 'es-ES';
                            utterance.rate = 0.9;
                            window.speechSynthesis.speak(utterance);
                        }
                        
                        if (callback) callback();
                    }
                    spins++;
                }, 100);
            }, delay);
        }
        
        // Confetti effect for wins
        function createConfetti() {
            const container = document.querySelector('.fruit-game-container');
            if (!container) return;
            
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.style.position = 'absolute';
                confetti.style.width = '10px';
                confetti.style.height = '10px';
                confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
                confetti.style.borderRadius = '50%';
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.top = '-10px';
                confetti.style.opacity = '0.8';
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                confetti.style.animation = `confetti-fall ${2 + Math.random() * 3}s linear forwards`;
                
                container.appendChild(confetti);
                
                // Remove confetti after animation
                setTimeout(() => {
                    confetti.remove();
                }, 5000);
            }
        }
        
        // Play sound effects
        function playSound(type) {
            if (!window.AudioContext) return;
            
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            let oscillator = audioCtx.createOscillator();
            let gainNode = audioCtx.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            // Different sounds for different events
            switch(type) {
                case 'spin':
                    // Continuous spinning sound
                    oscillator.type = 'sawtooth';
                    oscillator.frequency.setValueAtTime(200, audioCtx.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(800, audioCtx.currentTime + 0.5);
                    gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.8);
                    oscillator.start();
                    oscillator.stop(audioCtx.currentTime + 0.8);
                    break;
                    
                case 'reelStop':
                    // Short click when a reel stops
                    oscillator.type = 'square';
                    oscillator.frequency.setValueAtTime(1000, audioCtx.currentTime);
                    gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                    oscillator.start();
                    oscillator.stop(audioCtx.currentTime + 0.1);
                    break;
                    
                case 'win':
                    // Winning fanfare
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(523.25, audioCtx.currentTime); // C5
                    oscillator.frequency.setValueAtTime(659.25, audioCtx.currentTime + 0.1); // E5
                    oscillator.frequency.setValueAtTime(783.99, audioCtx.currentTime + 0.2); // G5
                    oscillator.frequency.setValueAtTime(1046.5, audioCtx.currentTime + 0.3); // C6
                    gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                    oscillator.start();
                    oscillator.stop(audioCtx.currentTime + 0.5);
                    break;
                    
                case 'lose':
                    // Sad trombone
                    oscillator.type = 'square';
                    oscillator.frequency.setValueAtTime(349.23, audioCtx.currentTime); // F4
                    oscillator.frequency.exponentialRampToValueAtTime(261.63, audioCtx.currentTime + 0.5); // C4
                    gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.6);
                    oscillator.start();
                    oscillator.stop(audioCtx.currentTime + 0.6);
                    break;
                    
                case 'activate':
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(784, audioCtx.currentTime); // G5
                    oscillator.frequency.exponentialRampToValueAtTime(1046.5, audioCtx.currentTime + 0.2); // C6
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                    oscillator.start();
                    oscillator.stop(audioCtx.currentTime + 0.3);
                    break;
                    
                case 'coin':
                    // Coin sound for wins
                    oscillator.type = 'triangle';
                    oscillator.frequency.setValueAtTime(988, audioCtx.currentTime); // B5
                    oscillator.frequency.exponentialRampToValueAtTime(1318, audioCtx.currentTime + 0.1); // E6
                    gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
                    oscillator.start();
                    oscillator.stop(audioCtx.currentTime + 0.2);
                    break;
            }
        }

        // Initialize the app when the page loads
        window.addEventListener('DOMContentLoaded', function() {
            // Check for saved night mode preference
            const savedNightMode = localStorage.getItem('nightMode') === 'true';
            if (savedNightMode) {
                isNightMode = true;
                document.body.classList.add('dark-mode');
                nightModeToggle.textContent = '☀️';
            }
            
            init();
        });
    </script>
</body>
</html>